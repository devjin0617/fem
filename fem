#!/bin/bash

# FEM (Frontend Macro) - Git Merge Helper
# Version: 1.0.0

# ë²„ì „ ì •ë³´
VERSION="1.0.0"

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
MAGENTA='\033[0;35m'
NC='\033[0m' # No Color

# ìŠ¤í¬ë¦½íŠ¸ ë””ë ‰í† ë¦¬
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# ë°°ë„ˆ ì¶œë ¥
show_banner() {
    echo -e "${CYAN}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                                       â•‘"
    echo "â•‘   ${MAGENTA}FEM${CYAN} - Frontend Macro            â•‘"
    echo "â•‘   Git Merge Helper v1.0.0            â•‘"
    echo "â•‘                                       â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
}

# í˜„ì¬ ë¸Œëœì¹˜ í™•ì¸
check_current_branch() {
    CURRENT_BRANCH=$(git branch --show-current 2>/dev/null)
    
    if [ -z "$CURRENT_BRANCH" ]; then
        echo -e "${RED}âŒ Git ì €ì¥ì†Œê°€ ì•„ë‹ˆê±°ë‚˜ ë¸Œëœì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.${NC}"
        exit 1
    fi
    
    echo -e "${BLUE}ğŸ“ í˜„ì¬ ë¸Œëœì¹˜: ${GREEN}$CURRENT_BRANCH${NC}"
    echo ""
}

# ë©”ë‰´ ì¶œë ¥
show_menu() {
    echo -e "${YELLOW}ì›í•˜ëŠ” ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”:${NC}"
    echo ""
    echo -e "  ${GREEN}1${NC}) server/devì— ë¨¸ì§€"
    echo -e "  ${GREEN}2${NC}) server/stagingì— ë¨¸ì§€"
    echo -e "  ${GREEN}3${NC}) ë‘ ì„œë²„ ëª¨ë‘ì— ìˆœì°¨ì ìœ¼ë¡œ ë¨¸ì§€"
    echo -e "  ${GREEN}4${NC}) ì¢…ë£Œ"
    echo ""
}

# server/dev ë¨¸ì§€ í•¨ìˆ˜
merge_to_dev() {
    echo -e "${BLUE}=========================================${NC}"
    echo -e "${CYAN}ğŸ“¦ server/devì— ë¨¸ì§€ ì‹œì‘...${NC}"
    echo -e "${BLUE}=========================================${NC}"
    echo ""
    
    CURRENT_BRANCH=$(git branch --show-current)
    
    echo "í˜„ì¬ ë¸Œëœì¹˜: $CURRENT_BRANCH"
    echo "server/dev ë¸Œëœì¹˜ë¡œ ì´ë™ ì¤‘..."
    
    git checkout server/dev
    if [ $? -ne 0 ]; then
        echo -e "${RED}âŒ server/dev ë¸Œëœì¹˜ë¡œ ì²´í¬ì•„ì›ƒ ì‹¤íŒ¨${NC}"
        return 1
    fi
    
    echo "server/dev ë¸Œëœì¹˜ pull ì¤‘..."
    git pull origin server/dev
    
    echo "$CURRENT_BRANCH ë¸Œëœì¹˜ë¥¼ server/devì— ë¨¸ì§€ ì¤‘..."
    git merge $CURRENT_BRANCH
    
    if [ $? -ne 0 ]; then
        echo -e "${RED}âŒ ë¨¸ì§€ ì‹¤íŒ¨. ì¶©ëŒì„ í•´ê²°í•´ì£¼ì„¸ìš”.${NC}"
        return 1
    fi
    
    echo -e "${GREEN}âœ… ë¨¸ì§€ ì„±ê³µ!${NC}"
    
    echo "$CURRENT_BRANCH ë¸Œëœì¹˜ë¡œ ë³µê·€ ì¤‘..."
    git checkout $CURRENT_BRANCH
    
    if [ $? -ne 0 ]; then
        echo -e "${RED}âŒ $CURRENT_BRANCH ë¸Œëœì¹˜ë¡œ ì²´í¬ì•„ì›ƒ ì‹¤íŒ¨${NC}"
        return 1
    fi
    
    echo -e "${GREEN}âœ… ì‘ì—… ì™„ë£Œ! $CURRENT_BRANCH ë¸Œëœì¹˜ë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤.${NC}"
    echo ""
    return 0
}

# server/staging ë¨¸ì§€ í•¨ìˆ˜
merge_to_staging() {
    echo -e "${BLUE}=========================================${NC}"
    echo -e "${CYAN}ğŸ“¦ server/stagingì— ë¨¸ì§€ ì‹œì‘...${NC}"
    echo -e "${BLUE}=========================================${NC}"
    echo ""
    
    CURRENT_BRANCH=$(git branch --show-current)
    
    echo "í˜„ì¬ ë¸Œëœì¹˜: $CURRENT_BRANCH"
    echo "server/staging ë¸Œëœì¹˜ë¡œ ì´ë™ ì¤‘..."
    
    git checkout server/staging
    if [ $? -ne 0 ]; then
        echo -e "${RED}âŒ server/staging ë¸Œëœì¹˜ë¡œ ì²´í¬ì•„ì›ƒ ì‹¤íŒ¨${NC}"
        return 1
    fi
    
    echo "server/staging ë¸Œëœì¹˜ pull ì¤‘..."
    git pull origin server/staging
    
    echo "$CURRENT_BRANCH ë¸Œëœì¹˜ë¥¼ server/stagingì— ë¨¸ì§€ ì¤‘..."
    git merge $CURRENT_BRANCH
    
    if [ $? -ne 0 ]; then
        echo -e "${RED}âŒ ë¨¸ì§€ ì‹¤íŒ¨. ì¶©ëŒì„ í•´ê²°í•´ì£¼ì„¸ìš”.${NC}"
        return 1
    fi
    
    echo -e "${GREEN}âœ… ë¨¸ì§€ ì„±ê³µ!${NC}"
    
    echo "$CURRENT_BRANCH ë¸Œëœì¹˜ë¡œ ë³µê·€ ì¤‘..."
    git checkout $CURRENT_BRANCH
    
    if [ $? -ne 0 ]; then
        echo -e "${RED}âŒ $CURRENT_BRANCH ë¸Œëœì¹˜ë¡œ ì²´í¬ì•„ì›ƒ ì‹¤íŒ¨${NC}"
        return 1
    fi
    
    echo -e "${GREEN}âœ… ì‘ì—… ì™„ë£Œ! $CURRENT_BRANCH ë¸Œëœì¹˜ë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤.${NC}"
    echo ""
    return 0
}

# ë‘ ì„œë²„ ëª¨ë‘ ë¨¸ì§€
merge_to_all() {
    CURRENT_BRANCH=$(git branch --show-current)
    
    echo -e "${BLUE}=========================================${NC}"
    echo -e "${CYAN}ğŸ“¦ ëª¨ë“  ì„œë²„ì— ìˆœì°¨ì ìœ¼ë¡œ ë¨¸ì§€ ì‹œì‘...${NC}"
    echo -e "${BLUE}=========================================${NC}"
    echo ""
    
    echo -e "${MAGENTA}ğŸ“Œ 1ë‹¨ê³„: server/devì— ë¨¸ì§€${NC}"
    merge_to_dev
    
    if [ $? -ne 0 ]; then
        echo -e "${RED}âŒ server/dev ë¨¸ì§€ ì‹¤íŒ¨. ì‘ì—…ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.${NC}"
        return 1
    fi
    
    echo -e "${MAGENTA}ğŸ“Œ 2ë‹¨ê³„: server/stagingì— ë¨¸ì§€${NC}"
    merge_to_staging
    
    if [ $? -ne 0 ]; then
        echo -e "${RED}âŒ server/staging ë¨¸ì§€ ì‹¤íŒ¨.${NC}"
        return 1
    fi
    
    echo -e "${BLUE}=========================================${NC}"
    echo -e "${GREEN}âœ… ëª¨ë“  ì‘ì—… ì™„ë£Œ!${NC}"
    echo -e "   ${CYAN}â€¢ server/dev: ë¨¸ì§€ ì™„ë£Œ${NC}"
    echo -e "   ${CYAN}â€¢ server/staging: ë¨¸ì§€ ì™„ë£Œ${NC}"
    echo -e "   ${CYAN}â€¢ í˜„ì¬ ë¸Œëœì¹˜: $CURRENT_BRANCH${NC}"
    echo -e "${BLUE}=========================================${NC}"
    echo ""
    return 0
}

# ë²„ì „ ì¶œë ¥
show_version() {
    echo "FEM (Frontend Macro) v$VERSION"
    exit 0
}

# ë„ì›€ë§ ì¶œë ¥
show_help() {
    echo "FEM (Frontend Macro) - Git Merge Helper"
    echo ""
    echo "ì‚¬ìš©ë²•: fem [ì˜µì…˜]"
    echo ""
    echo "ì˜µì…˜:"
    echo "  -v, --version    ë²„ì „ ì •ë³´ ì¶œë ¥"
    echo "  -h, --help       ë„ì›€ë§ ì¶œë ¥"
    echo ""
    echo "ì¸ì ì—†ì´ ì‹¤í–‰í•˜ë©´ ëŒ€í™”í˜• ë©”ë‰´ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤."
    exit 0
}

# ë©”ì¸ ë¡œì§
main() {
    # ì˜µì…˜ ì²˜ë¦¬
    case "${1:-}" in
        -v|--version)
            show_version
            ;;
        -h|--help)
            show_help
            ;;
        "")
            # ì¸ì ì—†ì´ ì‹¤í–‰ - ì •ìƒ ë™ì‘
            ;;
        *)
            echo -e "${RED}âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì˜µì…˜: $1${NC}"
            echo ""
            show_help
            ;;
    esac
    
    show_banner
    check_current_branch
    
    while true; do
        show_menu
        read -p "ì„ íƒ (1-4): " choice
        echo ""
        
        case $choice in
            1)
                merge_to_dev
                ;;
            2)
                merge_to_staging
                ;;
            3)
                merge_to_all
                ;;
            4)
                echo -e "${CYAN}ğŸ‘‹ ì¢…ë£Œí•©ë‹ˆë‹¤.${NC}"
                exit 0
                ;;
            *)
                echo -e "${RED}âŒ ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤. 1-4 ì¤‘ì—ì„œ ì„ íƒí•´ì£¼ì„¸ìš”.${NC}"
                echo ""
                ;;
        esac
        
        # ë‹¤ìŒ ì‘ì—…ì„ ìœ„í•´ ì ì‹œ ëŒ€ê¸°
        read -p "ì—”í„°ë¥¼ ëˆŒëŸ¬ ê³„ì†í•˜ì„¸ìš”..."
        echo ""
        echo ""
    done
}

# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
main "$@"

